<!DOCTYPE html>
<html>
<head>
  <title>Wilway</title>
  <link rel="stylesheet" href="/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="loading-screen" id="loadingScreen">
    <div class="progress-container">
      <img class="loading-image" src="/images/1.png" alt=".">
      <svg class="progress-circle" viewBox="0 0 200 200">
        <defs>
          <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:darkblue;" />
            <stop offset="100%" style="stop-color:darkcyan;" />
          </linearGradient>
        </defs>
        <circle cx="100" cy="100" r="90" />
      </svg>
    </div>
    <p id="loading-text" class="loading-text">Loading...</p>
  </div>
  <div class="background">
    <div class="home-container">
      <h1 style="font-family: Impact, 'Poppins', 'Arial Black', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight:bold; font-style:italic; font-size:6em; margin:0; background:linear-gradient(to bottom right, #007BFF, #00FFFF); -webkit-background-clip:text; -webkit-text-fill-color:transparent; -webkit-text-stroke:5px black; user-select:none; transform:rotate(5deg);">Go the Wilway!</h1>
      <p style="font-family: Impact, 'Poppins', 'Arial Black', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight:bold; font-size:1.2em; margin:0.2em 0; background:linear-gradient(to bottom right, #FF4D4D, #FF9999); -webkit-background-clip:text; -webkit-text-fill-color:transparent; -webkit-text-stroke:0.5px black; user-select:none; transform:rotate(1deg);">‚ö†Ô∏è Warning: This site is built for a specific school district and may not work properly for others.</p>
    </div>
    <iframe class="content-iframe" id="contentIframe" allowfullscreen></iframe>
  </div>
  <div class="hover-area"></div>
  <div class="bottom-bar">
    <button type="button" class="theme-button" onclick="buttonClick(1)">Home</button>
    <button type="button" class="theme-button" onclick="buttonClick(2)">VM/Prox</button>
    <button type="button" class="theme-button" onclick="buttonClick(3)">M0vies</button>
    <button type="button" class="theme-button" onclick="buttonClick(4)">Chesao</button>
    <button type="button" class="theme-button" onclick="buttonClick(5)">5</button>
    <button type="button" class="theme-button" onclick="buttonClick(6)">6</button>
    <button type="button" class="theme-button" onclick="buttonClick(7)">7</button>
    <button type="button" class="theme-button" onclick="buttonClick(8)">8</button>
    <button type="button" class="theme-button" onclick="buttonClick(9)">9</button>
    <button type="button" class="theme-button" onclick="buttonClick(10)">10</button>
  </div>
  <button type="button" class="settings-button" onclick="toggleSettingsPanel()">‚öôÔ∏è</button>
  <button type="button" class="fullscreen-button" onclick="toggleFullscreen()">‚õ∂</button>
  <button type="button" class="toggle-bar-button" onclick="toggleBottomBar()">üîΩ</button>
  <div class="settings-panel" id="settingsPanel">
    <button onclick="toggleAnimation()">Pause Animation</button>
    <button class="close-button" onclick="toggleSettingsPanel()">Close</button>
  </div>
  <script>
    let isLoading = false;
const TAB_COOLDOWN = 800;
let lastTabSwitch = 0;

    // Detect if Impact font is unavailable
    function detectImpactFont() {
      const testString = "test";
      const span = document.createElement('span');
      span.style.fontSize = '100px';
      span.style.visibility = 'hidden';
      span.style.position = 'absolute';
      span.textContent = testString;
      document.body.appendChild(span);

      span.style.fontFamily = 'Impact';
      const impactWidth = span.offsetWidth;

      span.style.fontFamily = 'Poppins';
      const fallbackWidth = span.offsetWidth;

      document.body.removeChild(span);

      if (impactWidth === fallbackWidth) {
        document.body.classList.add('no-impact');
      }
    }

    // Button click handler for iframe and selection
function buttonClick(buttonNumber) {
  if (isLoading) return; // Prevent overlapping calls
  isLoading = true;

  const loadingScreen = document.getElementById('loadingScreen');
  const progressCircle = document.querySelector('.progress-circle circle');
  const iframe = document.getElementById('contentIframe');
  const buttons = document.querySelectorAll('.theme-button');
  const homeContainer = document.querySelector('.home-container');
  const minDuration = 1500;
  const maxDuration = 1800;
  const duration = Math.random() * (maxDuration - minDuration) + minDuration;

  // Disable buttons during transition
  buttons.forEach(btn => btn.classList.add('disabled'));

  // Clear all selected states first
  buttons.forEach(btn => btn.classList.remove('selected'));

  // Set new selected state
  buttons[buttonNumber - 1].classList.add('selected');

  // Debugging log
  console.log(`Button ${buttonNumber} clicked`);

  const sources = {
    2: '/vm/',
    3: '/mov/',
    4: 'https://chesao.lol/',
    5: 'https://example.com/page5',
    6: 'https://example.com/page6',
    7: 'https://example.com/page7',
    8: 'https://example.com/page8',
    9: 'https://example.com/page9',
    10: 'https://example.com/page10'
  };

  const sourceUrl = sources[buttonNumber];
  console.log('Resolved URL:', sourceUrl);

  if (buttonNumber === 1) {
    iframe.style.display = 'none';
    homeContainer.classList.remove('hidden');
    console.log('Home button clicked, showing background and home elements');
  } else if (sourceUrl) {
    iframe.src = sourceUrl;
    iframe.style.display = 'block';
    homeContainer.classList.add('hidden');
    console.log(`Loading iframe with: ${sourceUrl}`);
  } else {
    console.warn(`‚ö†Ô∏è No URL defined for button ${buttonNumber}. Reverting to Home.`);
    iframe.style.display = 'none';
    homeContainer.classList.remove('hidden');
    buttons[buttonNumber - 1].classList.remove('selected');
    buttons[0].classList.add('selected');
    isLoading = false;
    buttons.forEach(btn => btn.classList.remove('disabled'));
    return;
  }

  // Show loading screen
  // Fetch a new random loading message before showing the loading screen
fetch('/core/messages.json')
  .then(response => response.json())
  .then(data => {
    const messages = data.messages;
    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
    const loadingText = document.getElementById('loading-text');
    if (loadingText) {
      loadingText.textContent = randomMessage;
    }
  })
  .catch(() => {
    const loadingText = document.getElementById('loading-text');
    if (loadingText) {
      loadingText.textContent = "Loading Wilway...";
    }
  });

  loadingScreen.style.display = 'flex';
  loadingScreen.style.animation = 'none';
  progressCircle.style.animation = 'none';
  loadingScreen.offsetHeight; // Force reflow
  loadingScreen.style.animation = `loadingFade ${duration}ms linear forwards`;
  progressCircle.style.animation = `progressFill ${duration}ms linear forwards`;

  setTimeout(() => {
    buttons.forEach(btn => btn.classList.remove('disabled'));
    loadingScreen.style.display = 'none';
    isLoading = false;
  }, duration);
}
    // Add click effect
    document.querySelectorAll('.theme-button').forEach(button => {
      button.addEventListener('click', function(e) {
        const rect = this.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const effect = document.createElement('span');
        effect.className = 'click-effect';
        effect.style.left = `${x}px`;
        effect.style.top = `${y}px`;
        this.appendChild(effect);
        
        effect.addEventListener('animationend', () => {
          effect.remove();
        });
      });
    });
    
    // Toggle settings panel
    function toggleSettingsPanel() {
      const panel = document.getElementById('settingsPanel');
      const pauseButton = panel.querySelector('button');
      const isVisible = !panel.classList.contains('hidden');

      if (isVisible) {
        panel.classList.add('hidden');
        setTimeout(() => {
          panel.style.display = 'none';
        }, 300);
      } else {
        panel.style.display = 'flex';
        panel.offsetHeight;
        panel.classList.remove('hidden');
      }

      const background = document.querySelector('.background');
      pauseButton.textContent = background.classList.contains('paused') ? 'Resume Animation' : 'Pause Animation';
    }

    // Toggle bottom bar, hover area, and fullscreen button
    function toggleBottomBar() {
      const bottomBar = document.querySelector('.bottom-bar');
      const hoverArea = document.querySelector('.hover-area');
      const fullscreenButton = document.querySelector('.fullscreen-button');
      const toggleButton = document.querySelector('.toggle-bar-button');
      const isVisible = !bottomBar.classList.contains('hidden');
      
      if (isVisible) {
        bottomBar.classList.add('hidden');
        hoverArea.classList.add('hidden');
        if (!document.fullscreenElement) {
          fullscreenButton.classList.remove('hidden');
          fullscreenButton.style.display = 'flex';
        }
        toggleButton.textContent = 'üîº';
        if (!toggleButton.textContent.match(/üîº/)) {
          toggleButton.textContent = '‚ñ≤';
        }
        setTimeout(() => {
          bottomBar.style.display = 'none';
          hoverArea.style.display = 'none';
        }, 300);
      } else {
        bottomBar.style.display = 'flex';
        hoverArea.style.display = 'block';
        fullscreenButton.style.display = 'none';
        bottomBar.offsetHeight;
        hoverArea.offsetHeight;
        bottomBar.classList.remove('hidden');
        hoverArea.classList.remove('hidden');
        fullscreenButton.classList.add('hidden');
        toggleButton.textContent = 'üîΩ';
        if (!toggleButton.textContent.match(/üîΩ/)) {
          toggleButton.textContent = '‚ñº';
        }
      }
    }

    // Toggle fullscreen mode
    function toggleFullscreen() {
      const fullscreenButton = document.querySelector('.fullscreen-button');
      if (document.fullscreenElement) {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      } else {
        if (document.documentElement.requestFullscreen) {
          document.documentElement.requestFullscreen();
        } else if (document.documentElement.mozRequestFullScreen) {
          document.documentElement.mozRequestFullScreen();
        } else if (document.documentElement.webkitRequestFullscreen) {
          document.documentElement.webkitRequestFullscreen();
        } else if (document.documentElement.msRequestFullscreen) {
          document.documentElement.msRequestFullscreen();
        }
        fullscreenButton.style.display = 'none';
        fullscreenButton.classList.add('hidden');
      }
    }

    function setCookie(name, value, days) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // Update fullscreen button visibility on fullscreen change
    document.addEventListener('fullscreenchange', () => {
      const fullscreenButton = document.querySelector('.fullscreen-button');
      const bottomBar = document.querySelector('.bottom-bar');
      if (!document.fullscreenElement && bottomBar.classList.contains('hidden')) {
        fullscreenButton.style.display = 'flex';
        fullscreenButton.classList.remove('hidden');
      } else {
        fullscreenButton.style.display = 'none';
        fullscreenButton.classList.add('hidden');
      }
    });
    document.addEventListener('mozfullscreenchange', () => {
      const fullscreenButton = document.querySelector('.fullscreen-button');
      const bottomBar = document.querySelector('.bottom-bar');
      if (!document.fullscreenElement && bottomBar.classList.contains('hidden')) {
        fullscreenButton.style.display = 'flex';
        fullscreenButton.classList.remove('hidden');
      } else {
        fullscreenButton.style.display = 'none';
        fullscreenButton.classList.add('hidden');
      }
    });
    document.addEventListener('webkitfullscreenchange', () => {
      const fullscreenButton = document.querySelector('.fullscreen-button');
      const bottomBar = document.querySelector('.bottom-bar');
      if (!document.fullscreenElement && bottomBar.classList.contains('hidden')) {
        fullscreenButton.style.display = 'flex';
        fullscreenButton.classList.remove('hidden');
      } else {
        fullscreenButton.style.display = 'none';
        fullscreenButton.classList.add('hidden');
      }
    });
    document.addEventListener('MSFullscreenChange', () => {
      const fullscreenButton = document.querySelector('.fullscreen-button');
      const bottomBar = document.querySelector('.bottom-bar');
      if (!document.fullscreenElement && bottomBar.classList.contains('hidden')) {
        fullscreenButton.style.display = 'flex';
        fullscreenButton.classList.remove('hidden');
      } else {
        fullscreenButton.style.display = 'none';
        fullscreenButton.classList.add('hidden');
      }
    });

    // Toggle animation and save state
    function toggleAnimation() {
      const background = document.querySelector('.background');
      const pauseButton = document.querySelector('#settingsPanel button');
      const isPaused = background.classList.contains('paused');
      
      if (isPaused) {
        background.classList.remove('paused');
        pauseButton.textContent = 'Pause Animation';
        setCookie('animationPaused', 'false', 30);
      } else {
        background.classList.add('paused');
        pauseButton.textContent = 'Resume Animation';
        setCookie('animationPaused', 'true', 30);
      }
    }

    // Initialize loading screen and other features
    let initialLoadDone = false;

document.addEventListener('DOMContentLoaded', () => {
  const loadingScreen = document.getElementById('loadingScreen');
  const progressCircle = document.querySelector('.progress-circle circle');

  // Check if user is new
  const isReturningUser = getCookie('visitedBefore') === 'true';

  // Duration logic
  let minDuration, maxDuration;

  if (isReturningUser) {
    minDuration = 1800;
    maxDuration = 2000;
  } else {
    minDuration = 3400;  // First time: longer
    maxDuration = 4000;
    setCookie('visitedBefore', 'true', 32); // Set cookie to expire in 32 days
  }

  const duration = Math.random() * (maxDuration - minDuration) + minDuration;

  loadingScreen.style.animationDuration = `${duration}ms`;
  progressCircle.style.animationDuration = `${duration}ms`;

  loadingScreen.addEventListener('animationend', () => {
    loadingScreen.style.display = 'none';
    const iframe = document.getElementById('contentIframe');
    const buttons = document.querySelectorAll('.theme-button');
    const homeContainer = document.querySelector('.home-container');
    buttons.forEach(btn => btn.classList.remove('selected'));
    buttons[0].classList.add('selected');
    iframe.style.display = 'none';
    // homeContainer.classList.remove('hidden');
  });
  
      const animationPaused = getCookie('animationPaused');
      const background = document.querySelector('.background');
      
      if (animationPaused === 'true') {
        background.classList.add('paused');
      } else {
        background.classList.remove('paused');
      }

      const toggleButton = document.querySelector('.toggle-bar-button');
      toggleButton.textContent = 'üîΩ';
      if (!toggleButton.textContent.match(/üîΩ/)) {
        toggleButton.textContent = '‚ñº';
      }

      detectImpactFont();
    });
  </script>
</body>
</html>
