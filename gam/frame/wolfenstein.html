<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Wolfenstein</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: black;
      overflow: hidden;
    }

    #canvas {
      display: block;
      margin: auto;
      background: black;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      outline: none;
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
    }
  </style>
</head>
<body>

<canvas id="canvas"
        width="320"
        height="200"
        tabindex="0"
        oncontextmenu="event.preventDefault()">
</canvas>

<script>
  const canvas = document.getElementById('canvas');

  function focusCanvas() {
    canvas.focus();
  }

  canvas.addEventListener('click', focusCanvas);
  window.addEventListener('load', () => {
    focusCanvas();
    scaleCanvas();
  });

  function scaleCanvas() {
    const baseW = canvas.width;
    const baseH = canvas.height;
    const aspect = baseW / baseH;

    const windowW = window.innerWidth;
    const windowH = window.innerHeight;

    let scaledW = windowW;
    let scaledH = windowW / aspect;

    if (scaledH > windowH) {
      scaledH = windowH;
      scaledW = windowH * aspect;
    }

    canvas.style.width = `${scaledW}px`;
    canvas.style.height = `${scaledH}px`;
  }

  window.addEventListener('resize', scaleCanvas);
  document.addEventListener('fullscreenchange', scaleCanvas);

  // Optional: press F to toggle fullscreen
  window.addEventListener('keydown', e => {
    if (e.key.toLowerCase() === 'f') {
      if (!document.fullscreenElement) {
        canvas.requestFullscreen().catch(() => {});
      } else {
        document.exitFullscreen();
      }
    }
  });
</script>

<script>
  function resumeSDLAudioContext() {
    if (SDL?.audioContext?.resume) {
      SDL.audioContext.resume().then(() => {});
    }
  }

  (function () {
    const origSetTimeout = window.setTimeout;
    let timers = 0;
    window.setTimeout = function(fn, t) {
      timers++;
      return origSetTimeout(() => {
        timers--;
        return fn();
      }, t);
    };
  })();
</script>

<script>
  var Module = {
    preRun: [], postRun: [],
    print: text => console.log(text),
    printErr: text => console.error(text),
    canvas: (function() {
      const c = document.getElementById('canvas');
      c.addEventListener('webglcontextlost', e => {
        alert('WebGL context lost — reload.');
        e.preventDefault();
      }, false);
      return c;
    })(),
    setStatus(text) { console.log('[status]', text); },
    totalDependencies: 0,
    monitorRunDependencies(left) {
      this.totalDependencies = Math.max(this.totalDependencies, left);
      Module.setStatus(
        left
          ? `Preparing... (${this.totalDependencies - left}/${this.totalDependencies})`
          : 'All downloads complete.'
      );
    }
  };

  Module.setStatus('Downloading...');
  window.onerror = e => {
    Module.setStatus('Exception — see console');
  };
</script>

<!-- Path to the emulator (replace with actual location if different) -->
<script async src="/core/gam-scripts/wolfenstein/Chocolate-Wolfenstein-3D.js"></script>
</body>
</html>
