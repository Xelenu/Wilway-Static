<!DOCTYPE html>
<html>
<head>
  <title>Wilway</title>
  <link rel="stylesheet" href="styles.css?v=5" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="loading-screen" id="loadingScreen">
    <div class="progress-container">
      <img class="loading-image" src="/images/1.png" alt="." draggable="false">
      <svg class="progress-circle" viewBox="0 0 200 200">
        <defs>
          <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:darkblue;" />
            <stop offset="100%" style="stop-color:darkcyan;" />
          </linearGradient>
        </defs>
        <circle cx="100" cy="100" r="90" />
      </svg>
    </div>
    <p id="loading-text" class="loading-text">Loading...</p>
  </div>
  <div class="background">
    <div class="home-container">
      <h1 style="font-family: Impact, 'Poppins', 'Arial Black', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight:bold; font-style:italic; font-size:6em; margin:0; background:linear-gradient(to bottom right, #007BFF, #00FFFF); -webkit-background-clip:text; -webkit-text-fill-color:transparent; -webkit-text-stroke:5px black; user-select:none; transform:rotate(5deg);">Go the Wilway!</h1>
      <p style="font-family: Impact, 'Poppins', 'Arial Black', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight:bold; font-size:1.2em; margin:0.2em 0; background:linear-gradient(to bottom right, #FF4D4D, #FF9999); -webkit-background-clip:text; -webkit-text-fill-color:transparent; -webkit-text-stroke:0.5px black; user-select:none; transform:rotate(1deg);">⚠️ Warning: This is an unstable version of Wilway, bugs and errors may arise.</p>
      <p style="font-family: Impact, 'Poppins', 'Arial Black', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight:bold; font-size:1.0em; margin:0.2em 0; background:linear-gradient(to bottom right, #888888, #dddddd); -webkit-background-clip:text; -webkit-text-fill-color:transparent; -webkit-text-stroke:0.5px black; user-select:none; background-color:gray; padding:0.2em 0.4em; display:inline-block;">Version 0.5</p>
    </div>
    <iframe class="content-iframe" id="contentIframe" allowfullscreen></iframe>
  </div>
  <div class="hover-area"></div>
  <div class="bottom-bar">
    <button type="button" class="theme-button" onclick="buttonClick(1)">Home</button>
    <button type="button" class="theme-button" onclick="buttonClick(2)">VOS</button>
    <button type="button" class="theme-button" onclick="buttonClick(3)">Gam</button>
    <button type="button" class="theme-button" onclick="buttonClick(4)">AI</button>
    <button type="button" class="theme-button" onclick="buttonClick(5)">Chat</button>
    <button type="button" class="theme-button" onclick="buttonClick(6)">Chesao</button>
    <button type="button" class="theme-button" onclick="buttonClick(7)">Other</button>
    <button type="button" class="theme-button" onclick="buttonClick(8)">Partners</button>
    <button type="button" class="theme-button" onclick="buttonClick(9)">About</button>
    <button type="button" class="theme-button" onclick="buttonClick(10)">Credits</button>
  </div>
  <button type="button" class="settings-button" onclick="toggleSettingsPanel()">⚙️</button>
  <button type="button" class="fullscreen-button" onclick="toggleFullscreen()">⛶</button>
  <button type="button" class="toggle-bar-button" onclick="toggleBottomBar()">🔽</button>
  <div class="settings-panel" id="settingsPanel">
    <h2 class="settings-title">Settings</h2>
    <p class="settings-subtitle">Configure</p>
    <div class="settings-tab-name-container">
      <button class="settings-tab-name-button" onclick="updatePageTitle()">Tab name</button>
      <input type="text" class="settings-tab-name-input" id="settingsTabNameInput" placeholder="Enter tab name">
    </div>
    <button class="cloak-button" id="cloakBtn" onclick="toggleCloak()">🔴 Cloak!</button>
    <hr class="divider">
    <button class="animation-button" onclick="toggleAnimation()">🟢 Animation</button>
    <button id="autoHideBtn" onclick="toggleAutoHide()">🔴 Auto-Hide Bar</button>
    <button id="fsHideSettingsBtn" onclick="toggleFsHideSettings()">🟢 Settings in fullscreen</button>
    <button class="close-button" onclick="toggleSettingsPanel()">Close</button>
  </div>
  <script>
    let isLoading = false;
    const TAB_COOLDOWN = 800;
    let lastTabSwitch = 0;
    let cloakEnabled = false;
    let initialLoadDone = false;

    function detectImpactFont() {
      const testString = "test";
      const span = document.createElement('span');
      span.style.fontSize = '100px';
      span.style.visibility = 'hidden';
      span.style.position = 'absolute';
      span.textContent = testString;
      document.body.appendChild(span);
      span.style.fontFamily = 'Impact';
      const impactWidth = span.offsetWidth;
      span.style.fontFamily = 'Poppins';
      const fallbackWidth = span.offsetWidth;
      document.body.removeChild(span);
      if (impactWidth === fallbackWidth) {
        document.body.classList.add('no-impact');
      }
    }

    function buttonClick(buttonNumber) {
      if (isLoading) return;
      isLoading = true;
      const loadingScreen = document.getElementById('loadingScreen');
      const progressCircle = document.querySelector('.progress-circle circle');
      const iframe = document.getElementById('contentIframe');
      const buttons = document.querySelectorAll('.theme-button');
      const homeContainer = document.querySelector('.home-container');
      const minDuration = 1000;
      const maxDuration = 1300;
      const duration = Math.random() * (maxDuration - minDuration) + minDuration;

      buttons.forEach(btn => btn.classList.add('disabled'));
      buttons.forEach(btn => btn.classList.remove('selected'));
      buttons[buttonNumber - 1].classList.add('selected');

      const sources = {
        2: '/vm/',
        3: '/gam/',
        4: '/ai/',
        5: '/chat/',
        6: '/chesao/',
        7: '/misc/',
        8: '/partner/',
        9: '/about/',
        10: '/credits/'
      };

      const sourceUrl = sources[buttonNumber];
      if (buttonNumber === 1) {
        iframe.style.display = 'none';
        homeContainer.classList.remove('hidden');
      } else if (sourceUrl) {
        iframe.src = sourceUrl;
        iframe.style.display = 'block';
        homeContainer.classList.add('hidden');
      } else {
        console.warn(`⚠️ No URL defined for button ${buttonNumber}. Reverting to Home.`);
        iframe.style.display = 'none';
        homeContainer.classList.remove('hidden');
        buttons[buttonNumber - 1].classList.remove('selected');
        buttons[0].classList.add('selected');
        isLoading = false;
        buttons.forEach(btn => btn.classList.remove('disabled'));
        return;
      }

      fetch('/core/messages.json')
        .then(response => response.json())
        .then(data => {
          const messages = data.messages;
          const randomMessage = messages[Math.floor(Math.random() * messages.length)];
          document.getElementById('loading-text').textContent = randomMessage;
        })
        .catch(() => {
          document.getElementById('loading-text').textContent = "Loading Wilway...";
        });

      loadingScreen.style.display = 'flex';
      loadingScreen.style.animation = 'none';
      progressCircle.style.animation = 'none';
      loadingScreen.offsetHeight;
      loadingScreen.style.animation = `loadingFade ${duration}ms linear forwards`;
      progressCircle.style.animation = `progressFill ${duration}ms linear forwards`;

      setTimeout(() => {
        buttons.forEach(btn => btn.classList.remove('disabled'));
        loadingScreen.style.display = 'none';
        isLoading = false;
      }, duration);
    }

    document.querySelectorAll('.theme-button').forEach(button => {
      button.addEventListener('click', function(e) {
        const rect = this.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const effect = document.createElement('span');
        effect.className = 'click-effect';
        effect.style.left = `${x}px`;
        effect.style.top = `${y}px`;
        this.appendChild(effect);
        effect.addEventListener('animationend', () => effect.remove());
      });
    });

    function toggleSettingsPanel() {
      const panel = document.getElementById('settingsPanel');
      const pauseButton = panel.querySelector('.animation-button');
      const isVisible = !panel.classList.contains('hidden');
      if (isVisible) {
        panel.classList.add('hidden');
        setTimeout(() => panel.style.display = 'none', 300);
      } else {
        panel.style.display = 'flex';
        panel.offsetHeight;
        panel.classList.remove('hidden');
      }
      const background = document.querySelector('.background');
      pauseButton.textContent = background.classList.contains('paused') ? '🔴 Animation' : '🟢 Animation';
    }

    function toggleBottomBar() {
      const bottomBar = document.querySelector('.bottom-bar');
      const hoverArea = document.querySelector('.hover-area');
      const fullscreenButton = document.querySelector('.fullscreen-button');
      const toggleButton = document.querySelector('.toggle-bar-button');
      const isVisible = !bottomBar.classList.contains('hidden');
      if (isVisible) {
        bottomBar.classList.add('hidden');
        hoverArea.classList.add('hidden');
        if (!document.fullscreenElement) {
          fullscreenButton.classList.remove('hidden');
          fullscreenButton.style.display = 'flex';
        }
        toggleButton.textContent = '🔼';
        setTimeout(() => {
          bottomBar.style.display = 'none';
          hoverArea.style.display = 'none';
        }, 300);
      } else {
        bottomBar.style.display = 'flex';
        hoverArea.style.display = 'block';
        fullscreenButton.style.display = 'none';
        bottomBar.offsetHeight;
        hoverArea.offsetHeight;
        bottomBar.classList.remove('hidden');
        hoverArea.classList.remove('hidden');
        fullscreenButton.classList.add('hidden');
        toggleButton.textContent = '🔽';
      }
    }

    function toggleFullscreen() {
      const fullscreenButton = document.querySelector('.fullscreen-button');
      if (document.fullscreenElement) {
        document.exitFullscreen();
      } else {
        document.documentElement.requestFullscreen();
        fullscreenButton.style.display = 'none';
        fullscreenButton.classList.add('hidden');
      }
    }

    function setCookie(name, value, days) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let c of ca) {
        while (c.charAt(0) === ' ') c = c.substring(1);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length);
      }
      return null;
    }

    function toggleCloak() {
      cloakEnabled = !cloakEnabled;
      const btn = document.getElementById('cloakBtn');
      setCookie('cloakEnabled', cloakEnabled, 30);
      btn.textContent = `${cloakEnabled ? '🟢' : '🔴'} Cloak!`;
      if (cloakEnabled) openCloakedWindow();
    }

    function openCloakedWindow() {
      const currentUrl = window.location.href;
      const blankWindow = window.open('about:blank', '_blank');
      if (blankWindow) {
        blankWindow.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>Wilway</title>
            <style>
              body { margin: 0; padding: 0; overflow: hidden; }
              iframe { width: 100vw; height: 100vh; border: none; }
            </style>
          </head>
          <body>
            <iframe src="${currentUrl}" allowfullscreen></iframe>
          </body>
          </html>
        `);
        blankWindow.document.close();
        window.location.href = 'https://classroom.google.com/';
      }
    }

    document.addEventListener('fullscreenchange', () => {
      const fullscreenButton = document.querySelector('.fullscreen-button');
      const bottomBar = document.querySelector('.bottom-bar');
      if (!document.fullscreenElement && bottomBar.classList.contains('hidden')) {
        fullscreenButton.style.display = 'flex';
        fullscreenButton.classList.remove('hidden');
      } else {
        fullscreenButton.style.display = 'none';
        fullscreenButton.classList.add('hidden');
      }
    });

    function toggleAnimation() {
      const background = document.querySelector('.background');
      const pauseButton = document.querySelector('.animation-button');
      const isPaused = background.classList.contains('paused');
      background.classList.toggle('paused');
      pauseButton.textContent = isPaused ? '🟢 Animation' : '🔴 Animation';
      setCookie('animationPaused', !isPaused, 30);
    }

    let autoHideEnabled = false;
    let fsHideSettingsEnabled = false;

    function toggleAutoHide() {
      autoHideEnabled = !autoHideEnabled;
      const btn = document.getElementById('autoHideBtn');
      setCookie('autoHideBar', autoHideEnabled, 30);
      btn.textContent = `${autoHideEnabled ? '🟢' : '🔴'} Auto-Hide Bar`;
      if (autoHideEnabled) {
        hideBottomBar();
        document.addEventListener('mousemove', handleMouseMove);
      } else {
        showBottomBar();
        document.removeEventListener('mousemove', handleMouseMove);
      }
    }

    function toggleFsHideSettings() {
      fsHideSettingsEnabled = !fsHideSettingsEnabled;
      const btn = document.getElementById('fsHideSettingsBtn');
      setCookie('fsHideSettings', fsHideSettingsEnabled, 30);
      btn.textContent = `${fsHideSettingsEnabled ? '🔴' : '🟢'} Settings in Fullscreen`;
      updateSettingsButtonVisibility();
    }

    function updateSettingsButtonVisibility() {
      const settingsBtn = document.querySelector('.settings-button');
      if (fsHideSettingsEnabled && document.fullscreenElement) {
        settingsBtn.style.display = 'none';
      } else {
        settingsBtn.style.display = 'flex';
      }
    }

    function hideBottomBar() {
      const bottomBar = document.querySelector('.bottom-bar');
      bottomBar.classList.add('hidden');
      setTimeout(() => bottomBar.style.display = 'none', 300);
    }

    function showBottomBar() {
      const bottomBar = document.querySelector('.bottom-bar');
      bottomBar.style.display = 'flex';
      bottomBar.offsetHeight;
      bottomBar.classList.remove('hidden');
    }

    function handleMouseMove(e) {
      const y = e.clientY;
      const height = window.innerHeight;
      if (y > height - 50) {
        showBottomBar();
      } else {
        setTimeout(() => {
          if (!bottomBar.matches(':hover')) hideBottomBar();
        }, 300);
      }
    }

    function updatePageTitle() {
      const input = document.getElementById('settingsTabNameInput');
      document.title = input.value.trim() || 'Wilway';
    }

    document.addEventListener('DOMContentLoaded', () => {
      detectImpactFont();
      const cloakBtn = document.getElementById('cloakBtn');
      const cloakCookie = getCookie('cloakEnabled');
      if (cloakCookie === 'true' && !initialLoadDone) {
        cloakEnabled = true;
        initialLoadDone = true;
        openCloakedWindow();
      }
      if (cloakBtn) cloakBtn.textContent = `${cloakEnabled ? '🟢' : '🔴'} Cloak!`;

      const autoHideBtn = document.getElementById('autoHideBtn');
      const autoHideCookie = getCookie('autoHideBar');
      if (autoHideCookie === 'true') {
        autoHideEnabled = true;
        autoHideBtn.textContent = '🟢 Auto-Hide Bar';
        hideBottomBar();
        document.addEventListener('mousemove', handleMouseMove);
      }

      const fsHideSettingsBtn = document.getElementById('fsHideSettingsBtn');
      const fsHideCookie = getCookie('fsHideSettings');
      if (fsHideCookie === 'true') {
        fsHideSettingsEnabled = true;
        fsHideSettingsBtn.textContent = '🔴 Settings in Fullscreen';
      }

      updateSettingsButtonVisibility();
      const loadingScreen = document.getElementById('loadingScreen');
      const progressCircle = document.querySelector('.progress-circle circle');
      const isReturningUser = getCookie('visitedBefore') === 'true';
      const duration = isReturningUser ? Math.random() * (2000 - 1800) + 1800 : Math.random() * (4000 - 3400) + 3400;
      if (!isReturningUser) setCookie('visitedBefore', 'true', 32);
      loadingScreen.style.animationDuration = `${duration}ms`;
      progressCircle.style.animationDuration = `${duration}ms`;
      loadingScreen.addEventListener('animationend', () => {
        loadingScreen.style.display = 'none';
        document.querySelectorAll('.theme-button')[0].classList.add('selected');
      });

      const animationPaused = getCookie('animationPaused');
      const background = document.querySelector('.background');
      const pauseButton = document.querySelector('.animation-button');
      if (animationPaused === 'true') {
        background.classList.add('paused');
        pauseButton.textContent = '🔴 Animation';
      }
    });
  </script>
</body>
</html>
